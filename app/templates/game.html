{% extends "base.html" %}
{% block title %}{{ game.summary.away_team }} @ {{ game.summary.home_team }} â€” The Live Sports Lounge{% endblock %}

{% block content %}
<div id="game-container" data-game-id="{{ game.summary.game_id }}" data-sport="{{ game.summary.sport }}">

    <!-- Back link -->
    <a href="/" class="inline-flex items-center gap-1 text-sm text-gray-400 hover:text-bball transition mb-4">
        &larr; Back to Scores
    </a>

    <!-- Hero score banner -->
    <div class="hardwood rounded-xl border border-white/5 p-6 mb-6 relative overflow-hidden"
         style="background-color: #16213e;">
        <!-- Faint court-line overlay -->
        <div class="court-lines absolute inset-0 rounded-xl pointer-events-none"></div>

        <div class="relative z-10">
            <!-- Status bar -->
            <div class="flex items-center justify-center gap-3 mb-5">
                {% if game.summary.status == 'live' %}
                <span id="game-status" class="broadcast-pill broadcast-pill--live">
                    <span class="live-pulse inline-block w-2 h-2 bg-green-400 rounded-full"></span>
                    <span id="period-clock">Q{{ game.summary.period }} {{ game.summary.clock }}</span>
                </span>
                {% elif game.summary.status == 'final' %}
                <span id="game-status" class="broadcast-pill broadcast-pill--final">
                    Final
                </span>
                {% else %}
                <span id="game-status" class="broadcast-pill broadcast-pill--scheduled">
                    {{ game.summary.start_time }}
                </span>
                {% endif %}
                <span class="text-[10px] font-bold tracking-widest px-2 py-0.5 rounded
                    {% if game.summary.sport == 'nba' %}bg-blue-600/20 text-blue-400{% else %}bg-orange-600/20 text-orange-400{% endif %}">
                    {{ game.summary.sport|upper }}
                </span>
            </div>

            <!-- Score grid -->
            <div class="grid grid-cols-3 items-center text-center">
                <div>
                    <div class="text-lg font-bold text-gray-300">{{ game.summary.away_team }}</div>
                    <div id="away-score" class="text-5xl font-mono font-bold text-white mt-1">{{ game.summary.away_score }}</div>
                </div>
                <div class="flex flex-col items-center gap-2">
                    <!-- Basketball hoop SVG -->
                    <svg class="w-8 h-8 opacity-40" viewBox="0 0 40 40" fill="none">
                        <rect x="12" y="4" width="16" height="2" rx="1" fill="#e8611a"/>
                        <rect x="14" y="4" width="12" height="10" rx="1" stroke="#e8611a" stroke-width="1.5" fill="none"/>
                        <circle cx="20" cy="16" r="6" stroke="#e8611a" stroke-width="1.5" fill="none"/>
                        <path d="M15 22 L14 30 M25 22 L26 30 M17 23 L16.5 29 M23 23 L23.5 29 M18.5 24 L18.5 30 M21.5 24 L21.5 30" stroke="#e8611a" stroke-width="0.8" opacity="0.6"/>
                    </svg>
                    <span class="vs-badge">VS</span>
                </div>
                <div>
                    <div class="text-lg font-bold text-gray-300">{{ game.summary.home_team }}</div>
                    <div id="home-score" class="text-5xl font-mono font-bold text-white mt-1">{{ game.summary.home_score }}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="mb-4 flex gap-1 bg-surface rounded-lg p-1">
        <button class="tab-btn flex-1 px-4 py-2 text-sm font-semibold rounded-md transition
            bg-surface-lighter text-white" data-tab="pbp">Play-by-Play</button>
        <button class="tab-btn flex-1 px-4 py-2 text-sm font-semibold rounded-md transition
            text-gray-500 hover:text-gray-300" data-tab="boxscore">Box Score</button>
        <button class="tab-btn flex-1 px-4 py-2 text-sm font-semibold rounded-md transition
            text-gray-500 hover:text-gray-300" data-tab="teamstats">Team Stats</button>
    </div>

    <!-- PBP panel -->
    <div id="tab-pbp" class="tab-panel">
        <div id="pbp-feed" class="bg-surface rounded-xl border border-white/5 divide-y divide-white/5 max-h-[600px] overflow-y-auto">
            {% for e in game.play_by_play %}
            <div class="px-4 py-3 flex items-start gap-3 text-sm {% if 'point' in e.description|lower or 'dunk' in e.description|lower or 'layup' in e.description|lower or 'three' in e.description|lower %}scoring-play{% endif %}">
                {% if 'point' in e.description|lower or 'dunk' in e.description|lower or 'layup' in e.description|lower or 'three' in e.description|lower %}
                <svg class="scoring-play-icon w-4 h-4 opacity-60" viewBox="0 0 20 20" fill="none">
                    <circle cx="10" cy="10" r="8" stroke="#e8611a" stroke-width="1.5"/>
                    <path d="M2 10 C7 10 13 5 18 10" stroke="#e8611a" stroke-width="1"/>
                    <path d="M2 10 C7 10 13 15 18 10" stroke="#e8611a" stroke-width="1"/>
                    <line x1="10" y1="2" x2="10" y2="18" stroke="#e8611a" stroke-width="1"/>
                </svg>
                {% endif %}
                <span class="text-gray-500 font-mono text-xs whitespace-nowrap w-16 shrink-0 pt-0.5">Q{{ e.period }} {{ e.clock }}</span>
                <span class="font-bold text-xs uppercase w-12 shrink-0 pt-0.5
                    {% if e.team == game.summary.home_team[:3]|upper or e.team == game.summary.home_team.split()[-1][:3]|upper %}text-blue-400{% else %}text-red-400{% endif %}">
                    {{ e.team }}
                </span>
                <span class="flex-1 text-gray-300">{{ e.description }}</span>
                <span class="text-gray-500 font-mono text-xs whitespace-nowrap pt-0.5">{{ e.away_score }}-{{ e.home_score }}</span>
            </div>
            {% endfor %}
            {% if not game.play_by_play %}
            <div class="px-4 py-8 text-center text-gray-500 text-sm">
                Play-by-play will appear when the game starts
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Box Score panel -->
    <div id="tab-boxscore" class="tab-panel hidden">
        <!-- Sub-tabs -->
        <div class="flex gap-2 mb-3">
            <button class="box-tab-btn px-4 py-1.5 text-xs font-bold rounded-full bg-accent text-dark" data-box="away">{{ game.summary.away_team }}</button>
            <button class="box-tab-btn px-4 py-1.5 text-xs font-bold rounded-full bg-surface-light text-gray-400 hover:text-gray-200" data-box="home">{{ game.summary.home_team }}</button>
        </div>

        <div id="box-away" class="box-panel">
            <div class="overflow-x-auto rounded-xl border border-white/5">
                <table class="w-full text-sm">
                    <thead class="bg-surface-lighter text-left text-xs uppercase text-gray-500 sticky top-0">
                        <tr>
                            <th class="px-3 py-2.5">Player</th>
                            <th class="px-3 py-2.5">MIN</th>
                            <th class="px-3 py-2.5">PTS</th>
                            <th class="px-3 py-2.5">REB</th>
                            <th class="px-3 py-2.5">AST</th>
                            <th class="px-3 py-2.5">STL</th>
                            <th class="px-3 py-2.5">BLK</th>
                            <th class="px-3 py-2.5">FG</th>
                            <th class="px-3 py-2.5">3PT</th>
                            <th class="px-3 py-2.5">FT</th>
                            <th class="px-3 py-2.5">+/-</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-white/5">
                        {% for p in game.away_players %}
                        <tr class="hover:bg-white/[0.02] {% if loop.index is odd %}bg-surface{% else %}bg-surface-light{% endif %}">
                            <td class="px-3 py-2.5 font-medium whitespace-nowrap text-gray-200">{{ p.name }} <span class="text-gray-500 text-xs">{{ p.position }}</span></td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.minutes }}</td>
                            <td class="px-3 py-2.5 font-mono font-bold text-white">{{ p.points }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.rebounds }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.assists }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.steals }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.blocks }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.fg }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.three_pt }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.ft }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs {% if p.plus_minus > 0 %}text-green-400{% elif p.plus_minus < 0 %}text-red-400{% else %}text-gray-500{% endif %}">
                                {% if p.plus_minus > 0 %}+{% endif %}{{ p.plus_minus }}
                            </td>
                        </tr>
                        {% endfor %}
                        {% if not game.away_players %}
                        <tr><td colspan="11" class="px-4 py-8 text-center text-gray-500 text-sm">Box score will appear when the game starts</td></tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <div id="box-home" class="box-panel hidden">
            <div class="overflow-x-auto rounded-xl border border-white/5">
                <table class="w-full text-sm">
                    <thead class="bg-surface-lighter text-left text-xs uppercase text-gray-500 sticky top-0">
                        <tr>
                            <th class="px-3 py-2.5">Player</th>
                            <th class="px-3 py-2.5">MIN</th>
                            <th class="px-3 py-2.5">PTS</th>
                            <th class="px-3 py-2.5">REB</th>
                            <th class="px-3 py-2.5">AST</th>
                            <th class="px-3 py-2.5">STL</th>
                            <th class="px-3 py-2.5">BLK</th>
                            <th class="px-3 py-2.5">FG</th>
                            <th class="px-3 py-2.5">3PT</th>
                            <th class="px-3 py-2.5">FT</th>
                            <th class="px-3 py-2.5">+/-</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-white/5">
                        {% for p in game.home_players %}
                        <tr class="hover:bg-white/[0.02] {% if loop.index is odd %}bg-surface{% else %}bg-surface-light{% endif %}">
                            <td class="px-3 py-2.5 font-medium whitespace-nowrap text-gray-200">{{ p.name }} <span class="text-gray-500 text-xs">{{ p.position }}</span></td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.minutes }}</td>
                            <td class="px-3 py-2.5 font-mono font-bold text-white">{{ p.points }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.rebounds }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.assists }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.steals }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.blocks }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.fg }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.three_pt }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs text-gray-400">{{ p.ft }}</td>
                            <td class="px-3 py-2.5 font-mono text-xs {% if p.plus_minus > 0 %}text-green-400{% elif p.plus_minus < 0 %}text-red-400{% else %}text-gray-500{% endif %}">
                                {% if p.plus_minus > 0 %}+{% endif %}{{ p.plus_minus }}
                            </td>
                        </tr>
                        {% endfor %}
                        {% if not game.home_players %}
                        <tr><td colspan="11" class="px-4 py-8 text-center text-gray-500 text-sm">Box score will appear when the game starts</td></tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Team Stats panel -->
    <div id="tab-teamstats" class="tab-panel hidden">
        <div class="grid sm:grid-cols-2 gap-4">
            <!-- Away team stats -->
            <div class="bg-surface rounded-xl border border-white/5 p-5">
                <h3 class="font-bold text-sm text-white mb-4">{{ game.summary.away_team }}</h3>
                <dl class="space-y-2 text-sm">
                    {% for key, val in game.away_team_stats.items() %}
                    <div class="flex justify-between">
                        <dt class="text-gray-500">{{ key }}</dt>
                        <dd class="font-mono text-gray-300">{{ val }}</dd>
                    </div>
                    {% endfor %}
                    {% if not game.away_team_stats %}
                    <div class="text-gray-500 text-center py-4">Stats will appear when the game starts</div>
                    {% endif %}
                </dl>
            </div>
            <!-- Home team stats -->
            <div class="bg-surface rounded-xl border border-white/5 p-5">
                <h3 class="font-bold text-sm text-white mb-4">{{ game.summary.home_team }}</h3>
                <dl class="space-y-2 text-sm">
                    {% for key, val in game.home_team_stats.items() %}
                    <div class="flex justify-between">
                        <dt class="text-gray-500">{{ key }}</dt>
                        <dd class="font-mono text-gray-300">{{ val }}</dd>
                    </div>
                    {% endfor %}
                    {% if not game.home_team_stats %}
                    <div class="text-gray-500 text-center py-4">Stats will appear when the game starts</div>
                    {% endif %}
                </dl>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/game.js"></script>
{% endblock %}
